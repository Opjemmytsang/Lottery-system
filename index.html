<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>åˆ†è¡Œä¸»ç®¡è¯æ­¡æ™šå®´ å£“è»¸å¹¸é‹å¤§æŠ½ç</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
      background: #f7f7f7;
      text-align: center;
      padding: 60px 20px;
      margin: 0;
      min-height: 100vh;
      box-sizing: border-box;
    }
    h1 {
      color: #333;
      font-size: 48px;
      margin-bottom: 20px;
      line-height: 1.2;
      white-space: pre-wrap;
    }
    p { font-size: 28px; margin-bottom: 40px; }
    .button-container {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
      margin: 30px 0;
    }
    button {
      padding: 20px 60px;
      font-size: 32px;
      cursor: pointer;
      color: white;
      border: none;
      border-radius: 12px;
      font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    #drawBtn { background-color: #0078d7; }
    #drawBtn:hover { background-color: #005a9e; }
    #resetBtn { background-color: #e74c3c; }
    #resetBtn:hover { background-color: #c0392b; }
    button:disabled { background-color: #aaa !important; cursor: not-allowed; box-shadow: none; }

    #display {
      margin: 40px 0;
      font-size: 60px;
      font-weight: bold;
      color: #2d3436;
      min-height: 100px;
      letter-spacing: 4px;
    }

    #winner {
      margin: 60px 0 40px;
      font-size: 48px;
      color: #d6336c;
      font-weight: bold;
      min-height: 80px;
      opacity: 0;
      transform: scale(0.9);
      transition: all 0.6s ease-out;
    }

    #winner.show {
      opacity: 1;
      transform: scale(1.05);
      animation: pulse 1s alternate 3;
    }

    @keyframes pulse {
      from { transform: scale(1.0); text-shadow: 0 0 15px #ff6b6b; }
      to   { transform: scale(1.15); text-shadow: 0 0 40px #ff4757, 0 0 60px #ff4757; }
    }

    #remaining { font-size: 28px; color: #555; margin-top: 30px; }

    audio { display: none; }

    @media (orientation: landscape) {
      body { padding: 40px 60px; }
      h1 { font-size: 52px; }
      #display { font-size: 70px; }
      #winner { font-size: 56px; }
    }
  </style>
</head>
<body>
  <h1>ğŸ‰åˆ†è¡Œä¸»ç®¡è¯æ­¡æ™šå®´<br>å£“è»¸å¹¸é‹å¤§æŠ½çğŸ‰</h1>
  <p>æŒ‰ä¸‹ã€Œé–‹å§‹æŠ½çã€é–‹å§‹ï¼Œé…æœ‰éŸ³æ•ˆ + èƒŒæ™¯éŸ³æ¨‚ï¼ï¼ˆSafari/iPad éœ€é»æ“Šå¾Œæ‰æ’­èƒŒæ™¯éŸ³æ¨‚ï¼‰<br>é‡æ–°æ•´ç†ä¹Ÿä¸æœƒé‡ç½®å·²æŠ½åå–®ï¼Œæƒ³å¾é ­é–‹å§‹è«‹æŒ‰ã€Œé‡è¨­æŠ½çã€</p>

  <!-- èƒŒæ™¯éŸ³æ¨‚ï¼šloop å¾ªç’°æ’­æ”¾ -->
  <audio id="bgMusic" loop preload="auto">
    <source src="Background-Music.mpeg" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <!-- æŠ½çéŸ³æ•ˆ -->
  <audio id="drumRoll" preload="auto">
    <source src="drumroll.mp3" type="audio/mpeg">
  </audio>
  <audio id="winSound" preload="auto">
    <source src="win-cheer.mp3" type="audio/mpeg">
  </audio>

  <div class="button-container">
    <button id="drawBtn" onclick="startDraw()">é–‹å§‹æŠ½ç</button>
    <button id="resetBtn" onclick="resetDraw()">é‡è¨­æŠ½ç</button>
  </div>

  <div id="display"></div>
  <div id="winner"></div>
  <div id="remaining">å‰©é¤˜äººæ•¸ï¼šè¨ˆç®—ä¸­...</div>

  <script>
    const STORAGE_KEY = "luckyDrawRemainingNames";

    const originalNames = [
      "CW4 é™³å°‘ç²","CWC æé‡‘éˆ•","CWD å‘¨æ…¶é‡—","JD6 å³åšé»˜","KF1 é»ƒç§€å¨Ÿ","KL1 æœå¤æˆ",
      "MA4 å§šæ–‡æˆ","MA5 ç¿å“æ•¬","MA6 ç›§ç†¾çƒ","MA8 å½­å¯æ˜Œ","MA9 æ—ç¾ç¥º","MAA æ–½éŠ˜å±±",
      "MAF å¼µåœ‹æ£Ÿ","MAG æ—å¿—å¼º","MAH å³æ–‡æ—","MAJ æ­å»£æ–‡","MAL æ¥Šè€€ç”Ÿ","MAM æ¯›å±•å¼·",
      "MAO ä½™åœ‹é›„","MAP æ—å…†å¼·","MAQ è‘‰æ²›é”","MAR é„§å‰å‚‘","MAS ç‹å±•éµ¬","MAU åŠ‰åœ‹è³¢",
      "MK1 éƒ­åŠå³°","MK2 é¦®å­æ³‰","MK7 ç‹ç”Ÿå‰","MK8 é™³å³°é›²","MKC ä½•å·","MKD æˆ´ç²ç²",
      "MKE åŠ‰ä¸–å‚‘","MKF é™³å°çª","MKG æé›…é›²","MO1 æœ±åœ‹å¼·","NC1 éº¥éŒ¦ç‡¦","NP4 å³å‡ç¦",
      "NP5 é™³ç§‹æ˜","SGO èŠå‰å¹³","SS1 å‹ä¿Šè«º","SS2 æç¥¥æ±Ÿ","ST5 é»ƒæ–‡é‹’","ST6 å¼µæ¼¢å¨",
      "TC1 èŠéŠ˜å¡¨","TF1 é‚±å¿—æ˜","TK2 é«˜æ–‡ç¦®","TK3 é„­å‰è¯","TK4 éƒ­å¿—å¼·","TK5 ææ·‘èŠ¬",
      "TM1 å³æ²›æ¬Š","TM3 é™³å¿—å‰","TM4 é„­å¿—å»º","TP1 é„§å±•éµ¬","TS6 å‘¨æ²»ä¸­","TSA å³æƒ è“‰",
      "TSB ä½™å¥æ—","TSC é™³å“å›","TW1 æ¥Šå‡±å¸†","TW2 é„­å¿—æ–‡","TW4 æ›¾æ˜­æ¨‘","TW5 è¨±æ ¢ç¥º",
      "TY1 ææ¼¢ç†™","WC1 å¼µå¿—å‚‘","WF1 æŸ¯èªŒæ³°","WT1 æå°è»","YL4 é—œé›ªå„€","YL5 æ¢ç¶­æ˜Œ",
      "å¸æ©Ÿ Johnny","é‡‘è‡³å°Š æ—æ‚…å½¬","é‡‘è‡³å°Š é™³å­å€«","é‡‘è‡³å°Š æ¥ŠæŒ¯æ°‘","é‡‘è‡³å°Š æœå…†æ¦®",
      "é‡‘è‡³å°Š è‘‰å®¶éº—","é›†åœ˜ ç‹å·§é™½","é›†åœ˜ é»ƒè˜­è©©","é›†åœ˜ é»ƒè˜‡å¨Ÿ","é›†åœ˜ æ—è¯","é›†åœ˜ å¾å®ˆç‘œ",
      "é›†åœ˜ é™³éœè³¢","é›†åœ˜ å¼µæ™ºå¼·","é›†åœ˜ è”¡éº—è¯","é›†åœ˜ å½­æ°¸æ¬Š","é›†åœ˜ ä½™éŒ¦æ± ","é›†åœ˜ è­šå‰è³¢",
      "é›†åœ˜ é»ä½©ç‘œ","é›†åœ˜ æå…†éºŸ","é›†åœ˜ é™³å¿—è±ª"
    ];

    let names = [];
    const savedNames = localStorage.getItem(STORAGE_KEY);
    if (savedNames) {
      try {
        names = JSON.parse(savedNames);
      } catch (e) {
        names = [...originalNames];
      }
    } else {
      names = [...originalNames];
    }

    const display = document.getElementById("display");
    const winnerDiv = document.getElementById("winner");
    const remainingDiv = document.getElementById("remaining");
    const drawBtn = document.getElementById("drawBtn");
    const drumRoll = document.getElementById("drumRoll");
    const winSound = document.getElementById("winSound");
    const bgMusic = document.getElementById("bgMusic");

    let isBgMusicStarted = false;  // é¿å…é‡è¤‡æ’­æ”¾

    function saveRemaining() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(names));
    }

    function updateRemaining() {
      remainingDiv.innerText = "å‰©é¤˜äººæ•¸ï¼š" + names.length;
      saveRemaining();
    }

    function startDraw() {
      // ç¬¬ä¸€æ¬¡é»æ“Šæ™‚å•Ÿå‹•èƒŒæ™¯éŸ³æ¨‚ï¼ˆSafari å…è¨±åœ¨ä½¿ç”¨è€…äº’å‹•å¾Œæ’­æ”¾ï¼‰
      if (!isBgMusicStarted) {
        bgMusic.volume = 0.3;  // èƒŒæ™¯éŸ³æ¨‚éŸ³é‡èª¿ä½ï¼Œé¿å…è“‹éæŠ½çéŸ³æ•ˆï¼ˆå¯èª¿æ•´ 0.1~0.5ï¼‰
        bgMusic.play().catch(e => console.log("èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾å¤±æ•—", e));
        isBgMusicStarted = true;
      }

      if (names.length === 0) {
        winnerDiv.innerText = "ğŸŠ æ‰€æœ‰äººéƒ½å·²ç¶“æŠ½éäº†ï¼ ğŸŠ";
        winnerDiv.classList.add("show");
        drawBtn.disabled = true;
        return;
      }

      drawBtn.disabled = true;
      winnerDiv.classList.remove("show");
      winnerDiv.innerText = "";

      drumRoll.currentTime = 0;
      drumRoll.play().catch(e => console.log("é¼“è²æ’­æ”¾å¤±æ•—", e));

      let shuffleCount = 0;
      const maxShuffles = 40 + Math.floor(Math.random() * 20);
      const shuffleInterval = setInterval(() => {
        const randomName = names[Math.floor(Math.random() * names.length)];
        display.innerText = randomName;
        shuffleCount++;

        if (shuffleCount >= maxShuffles) {
          clearInterval(shuffleInterval);
          drumRoll.pause();

          const index = Math.floor(Math.random() * names.length);
          const winner = names.splice(index, 1)[0];

          display.innerText = winner;
          winnerDiv.innerText = "ğŸŠ æ­å–œ " + winner + " ğŸŠ";
          winnerDiv.classList.add("show");

          winSound.currentTime = 0;
          winSound.play().catch(e => console.log("å‹åˆ©éŸ³æ•ˆæ’­æ”¾å¤±æ•—", e));

          updateRemaining();
          drawBtn.disabled = false;
        }
      }, 80);
    }

    function resetDraw() {
      if (confirm("ç¢ºå®šè¦é‡è¨­æŠ½çï¼Ÿæ‰€æœ‰å·²æŠ½éçš„åå–®å°‡æ¢å¾©ï¼ŒlocalStorage ä¹Ÿæœƒæ¸…é™¤ï¼")) {
        names = [...originalNames];
        localStorage.removeItem(STORAGE_KEY);
        display.innerText = "";
        winnerDiv.innerText = "";
        winnerDiv.classList.remove("show");
        drawBtn.disabled = false;
        drumRoll.pause();
        winSound.pause();
        // èƒŒæ™¯éŸ³æ¨‚ä¸éœ€é‡è¨­ï¼Œå¯ç¹¼çºŒæ’­æˆ–æš«åœï¼šé€™è£¡ä¿æŒç¹¼çºŒæ’­
        updateRemaining();
        alert("æŠ½çå·²é‡è¨­å®Œæˆï¼");
      }
    }

    updateRemaining();
  </script>
</body>
</html>
